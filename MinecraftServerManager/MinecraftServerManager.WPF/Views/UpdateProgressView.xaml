<UserControl x:Class="MinecraftServerManager.WPF.Views.UpdateProgressView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="http://schemas.modernwpf.com/2019"
             xmlns:converters="clr-namespace:MinecraftServerManager.WPF.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0" Text="Update Progress" FontSize="24" FontWeight="Bold" Margin="0,0,0,20"/>

        <!-- Current Stage -->
        <TextBlock Grid.Row="1"
                   Text="{Binding CurrentStage, StringFormat='Stage: {0}'}"
                   FontSize="16"
                   Margin="0,0,0,10"/>

        <!-- Progress Bar -->
        <Grid Grid.Row="2" Margin="0,0,0,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <ProgressBar Grid.Row="0"
                         Height="30"
                         Minimum="0"
                         Maximum="100"
                         Value="{Binding ProgressPercentage}"
                         IsIndeterminate="{Binding IsUpdating}"/>

            <TextBlock Grid.Row="0"
                       Text="{Binding ProgressPercentage, StringFormat='{}{0:F0}%'}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       FontWeight="Bold"/>

            <TextBlock Grid.Row="1"
                       Text="{Binding CurrentMessage}"
                       FontSize="14"
                       Margin="0,10,0,0"
                       TextWrapping="Wrap"/>
        </Grid>

        <!-- Detailed Logs -->
        <GroupBox Grid.Row="3" Header="Detailed Logs" Margin="0,0,0,10">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding DetailedLogs}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" FontFamily="Consolas" FontSize="12" Margin="2"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </GroupBox>

        <!-- Cancel Button -->
        <Button Grid.Row="4"
                Content="Cancel Update"
                Command="{Binding CancelUpdateCommand}"
                HorizontalAlignment="Right"
                Padding="20,8"
                Visibility="{Binding IsUpdating, Converter={StaticResource BoolToVisibility}}"/>
    </Grid>
</UserControl>
